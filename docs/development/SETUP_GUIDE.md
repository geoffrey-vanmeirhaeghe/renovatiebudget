# Development Setup Guide

Complete guide to setting up the RenovatieBudget development environment on your local machine.

## Prerequisites

### Required Software
- **Node.js**: Version 18+ (LTS recommended)
- **npm**: Version 9+ (comes with Node.js)
- **Git**: For version control
- **Modern Browser**: Chrome/Firefox with WebGL support
- **Code Editor**: VS Code recommended with Vue/Nuxt extensions

### Recommended VS Code Extensions
```
Vue Language Features (Volar)
TypeScript Vue Plugin (Volar)
Nuxt
Tailwind CSS IntelliSense
ESLint
Prettier
```

## Repository Structure

The RenovatieBudget platform consists of two repositories:

```
renovatiebudget/           # Frontend (Nuxt 3)
├── components/           # Vue components
├── composables/          # Vue composables (state management)
├── pages/               # Nuxt pages (routing)
├── types/               # TypeScript definitions
├── docs/                # Documentation (centralized)
└── assets/              # Static assets

renovatiebudget-strapi/   # Backend (Strapi CMS)
├── src/api/             # Content types & APIs
├── config/              # Strapi configuration
└── database/            # Database files
```

## Frontend Setup (Nuxt 3)

### 1. Clone and Install
```bash
# Clone the repository
git clone [repository-url] renovatiebudget
cd renovatiebudget

# Install dependencies
npm install
```

### 2. Environment Configuration
```bash
# Copy environment template
cp .env.example .env

# Edit .env file
STRAPI_BASE_URL=http://localhost:1337
```

### 3. Start Development Server
```bash
# Start Nuxt development server
npm run dev

# Server will start at http://localhost:3000
```

### 4. Available Commands
```bash
npm run dev         # Development server
npm run build       # Production build
npm run preview     # Preview production build
npm run generate    # Generate static site
```

## Backend Setup (Strapi)

### 1. Navigate to Strapi Directory
```bash
# Navigate to Strapi backend
cd ../renovatiebudget-strapi
```

### 2. Install Dependencies
```bash
npm install
```

### 3. Database Setup

#### PostgreSQL (Production-like)
If you prefer PostgreSQL (which you mentioned you usually use):

```bash
# Install PostgreSQL client
npm install pg

# Update config/database.js for PostgreSQL
# See Database Configuration section below
```

#### SQLite (Development Default)
Strapi comes configured with SQLite for development - no additional setup needed.

### 4. Environment Configuration
```bash
# Copy environment template
cp .env.example .env

# The .env file should contain (generated by Strapi):
HOST=0.0.0.0
PORT=1337
APP_KEYS=[generated-keys]
API_TOKEN_SALT=[generated-salt]
ADMIN_JWT_SECRET=[generated-secret]
JWT_SECRET=[generated-secret]
TRANSFER_TOKEN_SALT=[generated-salt]

# For PostgreSQL, add:
DATABASE_URL=postgresql://username:password@localhost:5432/renovatiebudget
```

### 5. Start Strapi
```bash
# Development mode with admin panel
npm run develop

# Strapi will start at http://localhost:1337
# Admin panel at http://localhost:1337/admin
```

### 6. First-Time Admin Setup
1. Visit http://localhost:1337/admin
2. Create your admin account
3. Content types are already configured

## Database Configuration

### PostgreSQL Setup (Recommended)

#### 1. Install PostgreSQL
```bash
# macOS (using Homebrew)
brew install postgresql
brew services start postgresql

# Create database
createdb renovatiebudget
```

#### 2. Update Strapi Configuration
Edit `config/database.js`:
```javascript
module.exports = ({ env }) => ({
  connection: {
    client: 'postgres',
    connection: {
      host: env('DATABASE_HOST', '127.0.0.1'),
      port: env.int('DATABASE_PORT', 5432),
      database: env('DATABASE_NAME', 'renovatiebudget'),
      user: env('DATABASE_USERNAME', 'your_username'),
      password: env('DATABASE_PASSWORD', 'your_password'),
      ssl: env.bool('DATABASE_SSL', false),
    },
  },
});
```

#### 3. Install PostgreSQL Client
```bash
npm install pg --save
```

### SQLite (Development Default)
No additional setup required - Strapi creates `database/data.db` automatically.

## Development Workflow

### 1. Typical Development Session
```bash
# Terminal 1: Start Strapi backend
cd renovatiebudget-strapi
npm run develop

# Terminal 2: Start Nuxt frontend  
cd renovatiebudget
npm run dev

# Both servers running:
# Frontend: http://localhost:3000
# Strapi Admin: http://localhost:1337/admin
# Strapi API: http://localhost:1337/api
```

### 2. Making Changes

#### Frontend Changes
- Edit components in `components/`
- Modify pages in `pages/`
- Update composables in `composables/`
- Hot reload automatically refreshes browser

#### Backend Changes
- Edit content types in `src/api/`
- Modify configurations in `config/`
- Strapi auto-restarts on file changes

### 3. Git Workflow
```bash
# Create feature branch
git checkout -b feature/your-feature-name

# Make changes and commit
git add .
git commit -m "Add feature description"

# Push to remote
git push origin feature/your-feature-name
```

## Environment Variables Reference

### Frontend (.env)
```env
# Strapi Backend URL
STRAPI_BASE_URL=http://localhost:1337

# Development settings
NUXT_PUBLIC_ENVIRONMENT=development
NUXT_PUBLIC_ENABLE_3D_DEBUG=false
NUXT_PUBLIC_DEFAULT_CAMERA_POSITION_MULTIPLIER=2.5
```

### Backend (.env)
```env
# Server configuration
HOST=0.0.0.0
PORT=1337

# Security keys (generated by Strapi)
APP_KEYS=your-app-keys
API_TOKEN_SALT=your-api-token-salt
ADMIN_JWT_SECRET=your-admin-jwt-secret
JWT_SECRET=your-jwt-secret
TRANSFER_TOKEN_SALT=your-transfer-token-salt

# Database (if using PostgreSQL)
DATABASE_HOST=127.0.0.1
DATABASE_PORT=5432
DATABASE_NAME=renovatiebudget
DATABASE_USERNAME=your_username
DATABASE_PASSWORD=your_password
```

## Content Types Overview

### Strapi Content Types (Backend)
- **Project**: Main project container
- **Building**: 3D house structure
- **Floor**: Individual floor levels
- **Renovation Work**: Work items and todos
- **User**: Extended user profiles

### API Endpoints
```
GET    /api/projects                 # List projects
GET    /api/projects/:id?populate=*  # Get project with relations
POST   /api/projects                 # Create project
PUT    /api/projects/:id             # Update project

GET    /api/renovation-works         # List renovation works
POST   /api/renovation-works         # Create work
PUT    /api/renovation-works/:id     # Update work

POST   /api/auth/local/register      # Register user
POST   /api/auth/local               # Login user
```

## Troubleshooting

### Common Issues

#### 1. Port Already in Use
```bash
# Kill process on port 3000 or 1337
lsof -ti:3000 | xargs kill -9
lsof -ti:1337 | xargs kill -9
```

#### 2. Module Resolution Issues
```bash
# Clear node_modules and reinstall
rm -rf node_modules package-lock.json
npm install
```

#### 3. Strapi Admin Panel 404
- Make sure you're visiting http://localhost:1337/admin (with /admin)
- Check that Strapi is running in develop mode

#### 4. 3D Visualization Not Loading
- Check browser console for WebGL errors
- Ensure modern browser with WebGL support
- Try disabling browser extensions

#### 5. Database Connection Issues
```bash
# Check PostgreSQL is running
brew services list | grep postgresql

# Test connection
psql -h localhost -p 5432 -U your_username -d renovatiebudget
```

### Performance Tips

#### 1. Faster Development Builds
```bash
# Use Nuxt devtools
npm run dev --devtools

# Disable source maps if slow
export NODE_OPTIONS="--max-old-space-size=4096"
```

#### 2. 3D Performance
- Use Chrome DevTools for WebGL debugging
- Monitor frame rates with built-in debug panel
- Reduce model complexity for testing

## VS Code Configuration

### Recommended Settings
Create `.vscode/settings.json`:
```json
{
  "typescript.preferences.includePackageJsonAutoImports": "on",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "editor.formatOnSave": true,
  "vetur.validation.template": false,
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact",
    "vue"
  ]
}
```

### Workspace Extensions
Create `.vscode/extensions.json`:
```json
{
  "recommendations": [
    "Vue.volar",
    "Vue.vscode-typescript-vue-plugin",
    "Nuxt.mdc",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint"
  ]
}
```

## Production Deployment

### Build Process
```bash
# Frontend production build
npm run build

# Strapi production build
npm run build
npm start
```

### Deployment Options

#### 1. DigitalOcean (Your Preference)
- **Frontend**: Static hosting or Droplet with Node.js
- **Backend**: Droplet with PostgreSQL
- **Database**: Managed PostgreSQL database

#### 2. Alternative Options
- **Vercel**: Frontend hosting (free tier available)
- **Railway/Render**: Full-stack hosting
- **AWS/Google Cloud**: Enterprise-level hosting

## Security Considerations

### Development Security
- Never commit `.env` files
- Use strong JWT secrets in production
- Enable HTTPS in production
- Configure CORS properly
- Use environment variables for all secrets

### Strapi Security
- Change default admin credentials
- Use strong JWT secrets
- Configure rate limiting
- Enable HTTPS
- Regular security updates

## Next Steps

### 1. Verify Setup
- [ ] Both servers running without errors
- [ ] Can access frontend at localhost:3000
- [ ] Can access Strapi admin at localhost:1337/admin
- [ ] User registration/login works
- [ ] 3D visualization loads properly

### 2. Development Workflow
- [ ] Make a test change in both frontend and backend
- [ ] Verify hot reload works
- [ ] Test API calls between frontend and backend
- [ ] Create test user and project

### 3. Optional Enhancements
- [ ] Set up testing framework (see TESTING_GUIDE.md)
- [ ] Configure linting/formatting
- [ ] Set up Git hooks
- [ ] Configure IDE debugging

## Getting Help

### Resources
- **Nuxt 3 Docs**: https://nuxt.com/docs
- **Strapi Docs**: https://strapi.io/documentation
- **Vue 3 Docs**: https://vuejs.org/guide/
- **Three.js Docs**: https://threejs.org/docs/

### Project Documentation
- **Main Documentation**: [PROJECT_DOCUMENTATION.md](../PROJECT_DOCUMENTATION.md)
- **Features Guide**: [FEATURES.md](../FEATURES.md)
- **Testing Guide**: [TESTING_GUIDE.md](./TESTING_GUIDE.md)

---

*Last Updated: September 2024*